<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Size Me</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      .pulse { animation: pulseAnim .5s ease; }
      @keyframes pulseAnim { 0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)} }
      @media print{
        body{ background:#fff !important; }
        .no-print{ display:none !important; }
        #results-print{ box-shadow:none !important; border:none !important; }
        .print-title{ font-size:20pt; margin-bottom:6pt; }
        .print-meta{ font-size:10pt; color:#555; margin-bottom:12pt; }
        .print-card{ page-break-inside:avoid; break-inside:avoid; }
      }
    </style>
  </head>
  <body class="bg-gradient-to-b from-slate-50 to-slate-100 text-slate-900">
    <div id="root"></div>

    <script type="text/babel" data-presets="react">
      const { useState, useMemo, useEffect } = React;

      /* ====================== Data ====================== */
      // NOTE: These are demo ranges (not brand-official). You can refine per brand later.
      const SIZE_CHARTS = {
        Nike:{Tops:{Men:[
          {label:"XS",chest:[81,86],waist:[66,73],hips:[80,86]},
          {label:"S", chest:[86,94],waist:[73,81],hips:[86,94]},
          {label:"M", chest:[94,102],waist:[81,89],hips:[94,102]},
          {label:"L", chest:[102,110],waist:[89,97],hips:[102,110]},
          {label:"XL",chest:[110,118],waist:[97,109],hips:[110,118]},
          {label:"XXL",chest:[118,126],waist:[109,121],hips:[118,126]}
        ],Women:[
          {label:"XS",chest:[76,83],waist:[60,67],hips:[84,90]},
          {label:"S", chest:[83,90],waist:[67,74],hips:[90,96]},
          {label:"M", chest:[90,97],waist:[74,81],hips:[96,103]},
          {label:"L", chest:[97,104],waist:[81,88],hips:[103,110]},
          {label:"XL",chest:[104,114],waist:[88,98],hips:[110,120]},
          {label:"XXL",chest:[114,124],waist:[98,108],hips:[120,130]}
        ]},Bottoms:{Men:[
          {label:"28",waist:[71,73],hips:[86,88],inseam:[76,86]},
          {label:"30",waist:[74,78],hips:[89,92],inseam:[76,86]},
          {label:"32",waist:[79,83],hips:[93,96],inseam:[76,86]},
          {label:"34",waist:[84,88],hips:[97,100],inseam:[76,86]},
          {label:"36",waist:[89,93],hips:[101,104],inseam:[76,86]},
          {label:"38",waist:[94,99],hips:[105,108],inseam:[76,86]},
          {label:"40",waist:[100,105],hips:[109,113],inseam:[76,86]}
        ],Women:[
          {label:"2",waist:[60,64],hips:[84,88],inseam:[72,84]},
          {label:"4",waist:[64,67],hips:[88,90],inseam:[72,84]},
          {label:"6",waist:[67,74],hips:[90,96],inseam:[74,84]},
          {label:"8",waist:[74,78],hips:[96,99],inseam:[74,86]},
          {label:"10",waist:[78,81],hips:[99,103],inseam:[74,86]},
          {label:"12",waist:[81,86],hips:[103,108],inseam:[74,86]},
          {label:"14",waist:[86,91],hips:[108,113],inseam:[74,86]}
        ]}},
        Adidas:{Tops:{Men:[
          {label:"XS",chest:[82,87],waist:[70,75],hips:[82,87]},
          {label:"S", chest:[88,94],waist:[76,82],hips:[88,94]},
          {label:"M", chest:[95,102],waist:[83,90],hips:[95,102]},
          {label:"L", chest:[103,111],waist:[91,99],hips:[103,111]},
          {label:"XL",chest:[112,121],waist:[100,109],hips:[112,121]},
          {label:"XXL",chest:[122,131],waist:[110,119],hips:[122,131]}
        ],Women:[
          {label:"XS",chest:[77,82],waist:[60,65],hips:[84,89]},
          {label:"S", chest:[83,88],waist:[66,72],hips:[90,95]},
          {label:"M", chest:[89,94],waist:[73,78],hips:[96,101]},
          {label:"L", chest:[95,103],waist:[79,86],hips:[102,110]},
          {label:"XL",chest:[104,113],waist:[87,96],hips:[111,119]}
        ]},Bottoms:{Men:[
          {label:"28",waist:[71,74],hips:[87,92],inseam:[76,86]},
          {label:"30",waist:[75,80],hips:[93,98],inseam:[76,86]},
          {label:"32",waist:[81,86],hips:[99,104],inseam:[76,86]},
          {label:"34",waist:[87,93],hips:[105,110],inseam:[76,86]},
          {label:"36",waist:[94,100],hips:[111,116],inseam:[76,86]},
          {label:"38",waist:[101,106],hips:[117,122],inseam:[76,86]}
        ],Women:[
          {label:"2-4",waist:[61,67],hips:[86,94],inseam:[72,84]},
          {label:"6-8",waist:[68,74],hips:[95,102],inseam:[72,86]},
          {label:"10-12",waist:[75,82],hips:[103,110],inseam:[74,86]},
          {label:"14-16",waist:[83,91],hips:[111,118],inseam:[74,86]}
        ]}},
        Uniqlo:{Tops:{Men:[
          {label:"XS",chest:[82,88],waist:[70,76],hips:[84,90]},
          {label:"S", chest:[86,92],waist:[74,80],hips:[88,94]},
          {label:"M", chest:[92,98],waist:[80,86],hips:[94,100]},
          {label:"L", chest:[98,104],waist:[86,92],hips:[100,106]},
          {label:"XL",chest:[104,110],waist:[92,98],hips:[106,112]},
          {label:"XXL",chest:[110,116],waist:[98,104],hips:[112,118]}
        ],Women:[
          {label:"XS",chest:[76,82],waist:[60,66],hips:[84,90]},
          {label:"S", chest:[80,86],waist:[64,70],hips:[88,94]},
          {label:"M", chest:[86,92],waist:[70,76],hips:[94,100]},
          {label:"L", chest:[92,98],waist:[76,82],hips:[100,106]},
          {label:"XL",chest:[98,104],waist:[82,88],hips:[106,112]}
        ]},Bottoms:{Men:[
          {label:"28",waist:[71,74],hips:[88,92],inseam:[74,86]},
          {label:"30",waist:[74,78],hips:[90,94],inseam:[74,86]},
          {label:"32",waist:[79,83],hips:[95,99],inseam:[74,86]},
          {label:"34",waist:[84,88],hips:[100,104],inseam:[74,86]},
          {label:"36",waist:[89,93],hips:[105,109],inseam:[74,86]}
        ],Women:[
          {label:"24-25",waist:[58,62],hips:[84,88],inseam:[72,82]},
          {label:"26-27",waist:[63,66],hips:[88,92],inseam:[72,84]},
          {label:"28-29",waist:[67,70],hips:[92,96],inseam:[72,84]},
          {label:"30-31",waist:[71,76],hips:[96,101],inseam:[73,85]},
          {label:"32-33",waist:[77,82],hips:[101,106],inseam:[73,85]}
        ]}},
        "H&M":{Tops:{Men:[
          {label:"XS",chest:[84,88],waist:[72,76],hips:[86,90]},
          {label:"S", chest:[88,94],waist:[76,82],hips:[90,96]},
          {label:"M", chest:[94,100],waist:[82,88],hips:[96,102]},
          {label:"L", chest:[100,106],waist:[88,94],hips:[102,108]},
          {label:"XL",chest:[106,114],waist:[94,102],hips:[108,116]}
        ],Women:[
          {label:"XS",chest:[78,82],waist:[60,64],hips:[84,88]},
          {label:"S", chest:[82,88],waist:[64,70],hips:[88,94]},
          {label:"M", chest:[88,94],waist:[70,76],hips:[94,100]},
          {label:"L", chest:[94,100],waist:[76,82],hips:[100,106]},
          {label:"XL",chest:[100,108],waist:[82,90],hips:[106,114]}
        ]},Bottoms:{Men:[
          {label:"28",waist:[72,76],hips:[88,92],inseam:[74,86]},
          {label:"30",waist:[76,80],hips:[92,96],inseam:[74,86]},
          {label:"32",waist:[80,84],hips:[96,100],inseam:[74,86]},
          {label:"34",waist:[84,90],hips:[100,106],inseam:[74,86]},
          {label:"36",waist:[90,96],hips:[106,112],inseam:[74,86]}
        ],Women:[
          {label:"2-4",waist:[61,66],hips:[86,92],inseam:[72,84]},
          {label:"6-8",waist:[67,73],hips:[93,99],inseam:[72,84]},
          {label:"10-12",waist:[74,80],hips:[100,106],inseam:[74,86]},
          {label:"14-16",waist:[81,88],hips:[107,114],inseam:[74,86]}
        ]}},
        "Zara":{Tops:{Men:[
          {label:"XS",chest:[86,90],waist:[74,78],hips:[88,92]},
          {label:"S", chest:[90,96],waist:[78,84],hips:[92,98]},
          {label:"M", chest:[96,102],waist:[84,90],hips:[98,104]},
          {label:"L", chest:[102,108],waist:[90,96],hips:[104,110]},
          {label:"XL",chest:[108,114],waist:[96,102],hips:[110,116]}
        ],Women:[
          {label:"XS",chest:[78,84],waist:[60,66],hips:[86,92]},
          {label:"S", chest:[84,90],waist:[66,72],hips:[92,98]},
          {label:"M", chest:[90,96],waist:[72,78],hips:[98,104]},
          {label:"L", chest:[96,102],waist:[78,84],hips:[104,110]},
          {label:"XL",chest:[102,108],waist:[84,90],hips:[110,116]}
        ]},Bottoms:{Men:[
          {label:"28",waist:[74,78],hips:[90,94],inseam:[74,86]},
          {label:"30",waist:[78,82],hips:[94,98],inseam:[74,86]},
          {label:"32",waist:[82,86],hips:[98,102],inseam:[74,86]},
          {label:"34",waist:[86,92],hips:[102,108],inseam:[74,86]}
        ],Women:[
          {label:"34(2)",waist:[60,64],hips:[86,90],inseam:[72,84]},
          {label:"36(4)",waist:[64,68],hips:[90,94],inseam:[72,84]},
          {label:"38(6)",waist:[68,72],hips:[94,98],inseam:[74,86]},
          {label:"40(8)",waist:[72,76],hips:[98,102],inseam:[74,86]},
          {label:"42(10)",waist:[76,80],hips:[102,106],inseam:[74,86]}
        ]}},
        "Levi's":{Tops:{Men:[
          {label:"S",chest:[91,96],waist:[76,81],hips:[90,95]},
          {label:"M",chest:[97,103],waist:[82,88],hips:[96,102]},
          {label:"L",chest:[104,110],waist:[89,95],hips:[103,109]},
          {label:"XL",chest:[111,118],waist:[96,103],hips:[110,117]}
        ],Women:[
          {label:"XS",chest:[79,84],waist:[62,67],hips:[86,91]},
          {label:"S",chest:[85,90],waist:[68,73],hips:[92,97]},
          {label:"M",chest:[91,96],waist:[74,79],hips:[98,103]},
          {label:"L",chest:[97,103],waist:[80,86],hips:[104,110]}
        ]},Bottoms:{Men:[
          {label:"29",waist:[74,76],hips:[90,94],inseam:[76,86]},
          {label:"31",waist:[79,82],hips:[95,100],inseam:[76,86]},
          {label:"33",waist:[83,86],hips:[101,106],inseam:[76,86]},
          {label:"35",waist:[87,92],hips:[107,112],inseam:[76,86]}
        ],Women:[
          {label:"26",waist:[64,67],hips:[90,93],inseam:[70,82]},
          {label:"27",waist:[67,70],hips:[93,96],inseam:[70,84]},
          {label:"28",waist:[70,73],hips:[96,99],inseam:[72,86]},
          {label:"29",waist:[73,76],hips:[99,102],inseam:[72,86]},
          {label:"30",waist:[76,79],hips:[102,105],inseam:[72,86]}
        ]}},
        "Gap":{Tops:{Men:[
          {label:"XS",chest:[84,89],waist:[71,76],hips:[86,91]},
          {label:"S", chest:[89,96],waist:[76,81],hips:[91,96]},
          {label:"M", chest:[96,104],waist:[81,89],hips:[96,104]},
          {label:"L", chest:[104,112],waist:[89,97],hips:[104,112]}
        ],Women:[
          {label:"XS",chest:[79,84],waist:[61,66],hips:[86,91]},
          {label:"S", chest:[84,89],waist:[66,71],hips:[91,97]},
          {label:"M", chest:[89,96],waist:[71,77],hips:[97,103]},
          {label:"L", chest:[96,104],waist:[77,84],hips:[103,110]}
        ]},Bottoms:{Men:[
          {label:"28",waist:[71,74],hips:[88,92],inseam:[74,86]},
          {label:"30",waist:[74,79],hips:[92,96],inseam:[74,86]},
          {label:"32",waist:[79,84],hips:[96,100],inseam:[74,86]},
          {label:"34",waist:[84,89],hips:[100,104],inseam:[74,86]}
        ],Women:[
          {label:"2",waist:[61,64],hips:[86,89],inseam:[70,82]},
          {label:"4",waist:[64,67],hips:[89,92],inseam:[70,84]},
          {label:"6",waist:[67,70],hips:[92,95],inseam:[72,86]},
          {label:"8",waist:[70,73],hips:[95,98],inseam:[72,86]}
        ]}},
        "Lululemon":{Tops:{Men:[
          {label:"XS",chest:[86,91],waist:[69,74],hips:[86,91]},
          {label:"S", chest:[91,97],waist:[74,79],hips:[91,97]},
          {label:"M", chest:[97,104],waist:[79,86],hips:[97,104]},
          {label:"L", chest:[104,112],waist:[86,94],hips:[104,112]},
          {label:"XL",chest:[112,122],waist:[94,104],hips:[112,122]}
        ],Women:[
          {label:"2",chest:[78,82],waist:[60,64],hips:[84,88]},
          {label:"4",chest:[82,86],waist:[64,68],hips:[88,92]},
          {label:"6",chest:[86,90],waist:[68,74],hips:[92,98]},
          {label:"8",chest:[90,96],waist:[74,80],hips:[98,104]},
          {label:"10",chest:[96,102],waist:[80,86],hips:[104,110]}
        ]},Bottoms:{Men:[
          {label:"S(28-30)",waist:[71,79],hips:[86,96],inseam:[74,86]},
          {label:"M(31-33)",waist:[79,86],hips:[96,104],inseam:[74,86]},
          {label:"L(34-36)",waist:[86,94],hips:[104,112],inseam:[74,86]}
        ],Women:[
          {label:"2-4",waist:[60,68],hips:[84,92],inseam:[70,84]},
          {label:"6-8",waist:[68,80],hips:[92,104],inseam:[72,86]},
          {label:"10-12",waist:[80,92],hips:[104,116],inseam:[74,88]}
        ]}},
        "Patagonia":{Tops:{Men:[
          {label:"XS",chest:[86,89],waist:[69,72],hips:[86,89]},
          {label:"S", chest:[89,94],waist:[72,76],hips:[89,94]},
          {label:"M", chest:[97,102],waist:[79,84],hips:[97,102]},
          {label:"L", chest:[107,112],waist:[89,94],hips:[107,112]},
          {label:"XL",chest:[117,122],waist:[99,104],hips:[117,122]}
        ],Women:[
          {label:"XS",chest:[79,84],waist:[62,66],hips:[86,90]},
          {label:"S", chest:[84,89],waist:[66,71],hips:[90,95]},
          {label:"M", chest:[89,94],waist:[71,76],hips:[95,100]},
          {label:"L", chest:[94,102],waist:[76,84],hips:[100,108]}
        ]},Bottoms:{Men:[
          {label:"28-30",waist:[71,79],hips:[88,96],inseam:[74,86]},
          {label:"31-33",waist:[79,86],hips:[96,104],inseam:[74,86]},
          {label:"34-36",waist:[86,94],hips:[104,112],inseam:[74,86]}
        ],Women:[
          {label:"2-4",waist:[61,68],hips:[86,94],inseam:[72,84]},
          {label:"6-8",waist:[68,76],hips:[94,102],inseam:[72,86]},
          {label:"10-12",waist:[76,84],hips:[102,110],inseam:[74,86]}
        ]}},
        "The North Face":{Tops:{Men:[
          {label:"S",chest:[91,96],waist:[73,78],hips:[90,95]},
          {label:"M",chest:[97,104],waist:[79,86],hips:[96,103]},
          {label:"L",chest:[105,112],waist:[87,94],hips:[104,111]},
          {label:"XL",chest:[113,121],waist:[95,104],hips:[112,120]}
        ],Women:[
          {label:"XS",chest:[79,83],waist:[61,65],hips:[84,88]},
          {label:"S",chest:[84,88],waist:[66,70],hips:[89,93]},
          {label:"M",chest:[89,94],waist:[71,76],hips:[94,99]},
          {label:"L",chest:[95,101],waist:[77,83],hips:[100,106]}
        ]},Bottoms:{Men:[
          {label:"28-30",waist:[71,79],hips:[88,96],inseam:[74,86]},
          {label:"32-34",waist:[81,89],hips:[98,106],inseam:[74,86]},
          {label:"36-38",waist:[91,99],hips:[108,116],inseam:[74,86]}
        ],Women:[
          {label:"2-4",waist:[61,68],hips:[86,94],inseam:[70,84]},
          {label:"6-8",waist:[68,76],hips:[94,102],inseam:[72,86]},
          {label:"10-12",waist:[76,84],hips:[102,110],inseam:[74,86]}
        ]}},
        "Columbia":{Tops:{Men:[
          {label:"S",chest:[89,96],waist:[73,80],hips:[88,95]},
          {label:"M",chest:[97,104],waist:[81,88],hips:[96,103]},
          {label:"L",chest:[105,112],waist:[89,96],hips:[104,111]},
          {label:"XL",chest:[113,121],waist:[97,104],hips:[112,120]}
        ],Women:[
          {label:"XS",chest:[79,84],waist:[61,66],hips:[84,90]},
          {label:"S",chest:[84,89],waist:[66,71],hips:[90,96]},
          {label:"M",chest:[89,96],waist:[71,78],hips:[96,104]},
          {label:"L",chest:[96,104],waist:[78,85],hips:[104,112]}
        ]},Bottoms:{Men:[
          {label:"28-30",waist:[71,79],hips:[88,96],inseam:[74,86]},
          {label:"32-34",waist:[81,89],hips:[98,106],inseam:[74,86]},
          {label:"36-38",waist:[91,99],hips:[108,116],inseam:[74,86]}
        ],Women:[
          {label:"2-4",waist:[61,68],hips:[86,94],inseam:[70,84]},
          {label:"6-8",waist:[68,76],hips:[94,102],inseam:[72,86]},
          {label:"10-12",waist:[76,84],hips:[102,110],inseam:[74,86]}
        ]}},
        "Carhartt":{Tops:{Men:[
          {label:"S",chest:[89,94],waist:[76,81],hips:[90,95]},
          {label:"M",chest:[97,102],waist:[84,89],hips:[97,102]},
          {label:"L",chest:[104,112],waist:[91,99],hips:[104,112]},
          {label:"XL",chest:[114,122],waist:[102,110],hips:[114,122]}
        ],Women:[
          {label:"XS",chest:[79,84],waist:[62,67],hips:[86,91]},
          {label:"S",chest:[84,89],waist:[67,72],hips:[91,97]},
          {label:"M",chest:[89,96],waist:[72,79],hips:[97,104]},
          {label:"L",chest:[96,104],waist:[79,86],hips:[104,112]}
        ]},Bottoms:{Men:[
          {label:"30",waist:[76,79],hips:[92,96],inseam:[76,86]},
          {label:"32",waist:[81,84],hips:[96,100],inseam:[76,86]},
          {label:"34",waist:[86,89],hips:[100,104],inseam:[76,86]},
          {label:"36",waist:[91,94],hips:[104,108],inseam:[76,86]}
        ],Women:[
          {label:"2-4",waist:[61,68],hips:[86,94],inseam:[72,84]},
          {label:"6-8",waist:[68,76],hips:[94,102],inseam:[72,86]},
          {label:"10-12",waist:[76,84],hips:[102,110],inseam:[74,86]}
        ]}},
        "Everlane":{Tops:{Men:[
          {label:"XS",chest:[86,91],waist:[71,76],hips:[86,91]},
          {label:"S",chest:[91,96],waist:[76,81],hips:[91,96]},
          {label:"M",chest:[96,102],waist:[81,86],hips:[96,102]},
          {label:"L",chest:[102,109],waist:[86,94],hips:[102,109]}
        ],Women:[
          {label:"XXS",chest:[76,80],waist:[58,62],hips:[84,88]},
          {label:"XS",chest:[80,84],waist:[62,66],hips:[88,92]},
          {label:"S",chest:[84,88],waist:[66,70],hips:[92,96]},
          {label:"M",chest:[88,94],waist:[70,76],hips:[96,102]}
        ]},Bottoms:{Men:[
          {label:"28",waist:[71,74],hips:[88,92],inseam:[74,86]},
          {label:"30",waist:[74,79],hips:[92,96],inseam:[74,86]},
          {label:"32",waist:[79,84],hips:[96,100],inseam:[74,86]},
          {label:"34",waist:[84,89],hips:[100,104],inseam:[74,86]}
        ],Women:[
          {label:"24-25",waist:[58,64],hips:[84,90],inseam:[70,82]},
          {label:"26-27",waist:[64,70],hips:[90,96],inseam:[72,84]},
          {label:"28-29",waist:[70,76],hips:[96,102],inseam:[74,86]}
        ]}},
        "Reformation":{Tops:{Women:[
          {label:"0",chest:[79,82],waist:[60,63],hips:[84,87]},
          {label:"2",chest:[82,85],waist:[63,66],hips:[87,90]},
          {label:"4",chest:[86,89],waist:[67,70],hips:[91,94]},
          {label:"6",chest:[90,93],waist:[71,74],hips:[95,98]},
          {label:"8",chest:[94,98],waist:[75,79],hips:[99,103]}
        ]},Bottoms:{Women:[
          {label:"24",waist:[61,64],hips:[86,89],inseam:[72,84]},
          {label:"25",waist:[64,67],hips:[89,92],inseam:[72,84]},
          {label:"26",waist:[67,70],hips:[92,95],inseam:[72,84]},
          {label:"27",waist:[70,73],hips:[95,98],inseam:[72,84]}
        ]}},
        "ASOS":{Tops:{Men:[
          {label:"XS",chest:[86,91],waist:[71,76],hips:[86,91]},
          {label:"S",chest:[91,96],waist:[76,81],hips:[91,96]},
          {label:"M",chest:[96,101],waist:[81,86],hips:[96,101]},
          {label:"L",chest:[101,106],waist:[86,91],hips:[101,106]}
        ],Women:[
          {label:"4",chest:[76,80],waist:[58,62],hips:[84,88]},
          {label:"6",chest:[80,84],waist:[62,66],hips:[88,92]},
          {label:"8",chest:[84,88],waist:[66,70],hips:[92,96]},
          {label:"10",chest:[88,92],waist:[70,74],hips:[96,100]}
        ]},Bottoms:{Men:[
          {label:"28",waist:[71,74],hips:[88,92],inseam:[74,86]},
          {label:"30",waist:[74,79],hips:[92,96],inseam:[74,86]},
          {label:"32",waist:[79,84],hips:[96,100],inseam:[74,86]}
        ],Women:[
          {label:"4-6",waist:[58,66],hips:[84,92],inseam:[72,84]},
          {label:"8-10",waist:[66,74],hips:[92,100],inseam:[72,86]},
          {label:"12-14",waist:[74,82],hips:[100,108],inseam:[74,86]}
        ]}},
        "Reebok":{Tops:{Men:[
          {label:"S",chest:[89,94],waist:[76,82],hips:[88,94]},
          {label:"M",chest:[95,102],waist:[83,90],hips:[95,102]},
          {label:"L",chest:[103,111],waist:[91,99],hips:[103,111]}
        ],Women:[
          {label:"S",chest:[83,88],waist:[66,72],hips:[90,95]},
          {label:"M",chest:[89,94],waist:[73,78],hips:[96,101]},
          {label:"L",chest:[95,103],waist:[79,86],hips:[102,110]}
        ]},Bottoms:{Men:[
          {label:"S(30)",waist:[76,81],hips:[90,96],inseam:[74,86]},
          {label:"M(32)",waist:[81,86],hips:[96,101],inseam:[74,86]}
        ],Women:[
          {label:"S(6-8)",waist:[66,74],hips:[92,100],inseam:[72,86]},
          {label:"M(10-12)",waist:[74,82],hips:[100,108],inseam:[74,86]}
        ]}},
        "New Balance":{Tops:{Men:[
          {label:"S",chest:[89,94],waist:[76,81],hips:[88,94]},
          {label:"M",chest:[95,102],waist:[81,88],hips:[95,102]},
          {label:"L",chest:[103,111],waist:[89,97],hips:[103,111]}
        ],Women:[
          {label:"S",chest:[82,88],waist:[64,70],hips:[90,96]},
          {label:"M",chest:[88,94],waist:[70,76],hips:[96,102]},
          {label:"L",chest:[94,100],waist:[76,82],hips:[102,108]}
        ]},Bottoms:{Men:[
          {label:"S(30)",waist:[76,81],hips:[90,95],inseam:[74,86]},
          {label:"M(32)",waist:[81,86],hips:[95,100],inseam:[74,86]}
        ],Women:[
          {label:"S(4-6)",waist:[63,70],hips:[88,96],inseam:[72,84]},
          {label:"M(8-10)",waist:[70,78],hips:[96,104],inseam:[72,86]}
        ]}},
        "Puma":{Tops:{Men:[
          {label:"S",chest:[88,94],waist:[76,82],hips:[88,94]},
          {label:"M",chest:[95,102],waist:[83,90],hips:[95,102]},
          {label:"L",chest:[103,110],waist:[91,98],hips:[103,110]}
        ],Women:[
          {label:"S",chest:[82,88],waist:[64,70],hips:[90,96]},
          {label:"M",chest:[88,94],waist:[70,76],hips:[96,102]},
          {label:"L",chest:[94,100],waist:[76,82],hips:[102,108]}
        ]},Bottoms:{Men:[
          {label:"S(30)",waist:[76,81],hips:[90,96],inseam:[74,86]},
          {label:"M(32)",waist:[81,86],hips:[96,101],inseam:[74,86]}
        ],Women:[
          {label:"S(4-6)",waist:[63,70],hips:[88,96],inseam:[72,84]},
          {label:"M(8-10)",waist:[70,78],hips:[96,104],inseam:[72,86]}
        ]}},
        "Under Armour":{Tops:{Men:[
          {label:"S",chest:[86,94],waist:[71,76],hips:[86,94]},
          {label:"M",chest:[96,104],waist:[76,84],hips:[94,102]},
          {label:"L",chest:[106,114],waist:[84,94],hips:[102,110]}
        ],Women:[
          {label:"XS",chest:[78,84],waist:[60,66],hips:[84,90]},
          {label:"S",chest:[84,90],waist:[66,72],hips:[90,96]},
          {label:"M",chest:[90,97],waist:[72,79],hips:[96,103]}
        ]},Bottoms:{Men:[
          {label:"S(28-30)",waist:[71,79],hips:[86,96],inseam:[74,86]},
          {label:"M(31-33)",waist:[79,86],hips:[96,104],inseam:[74,86]}
        ],Women:[
          {label:"XS(0-2)",waist:[60,66],hips:[84,90],inseam:[70,82]},
          {label:"S(4-6)",waist:[66,74],hips:[90,98],inseam:[72,84]}
        ]}},
      };

      // Web logo URLs (fallback to text if they fail)
      const BRAND_LOGOS = {
        Nike:"https://upload.wikimedia.org/wikipedia/commons/a/a6/Logo_NIKE.svg",
        Adidas:"https://upload.wikimedia.org/wikipedia/commons/2/20/Adidas_Logo.svg",
        Uniqlo:"https://upload.wikimedia.org/wikipedia/commons/2/20/Uniqlo_logo.svg",
        "H&M":"https://upload.wikimedia.org/wikipedia/commons/5/53/H%26M-Logo.svg",
        Zara:"https://upload.wikimedia.org/wikipedia/commons/f/fd/Zara_Logo.svg",
        "Levi's":"https://upload.wikimedia.org/wikipedia/commons/2/2a/Levi%27s_logo.svg",
        Gap:"https://upload.wikimedia.org/wikipedia/commons/8/8e/Gap_logo.svg",
        Lululemon:"https://upload.wikimedia.org/wikipedia/commons/7/7b/Lululemon_Athletica_logo.svg",
        Patagonia:"https://upload.wikimedia.org/wikipedia/commons/8/86/Patagonia_logo.svg",
        "The North Face":"https://upload.wikimedia.org/wikipedia/commons/5/53/The_North_Face_logo.svg",
        Columbia:"https://upload.wikimedia.org/wikipedia/commons/0/0f/Columbia_Sportswear_logo.svg",
        Carhartt:"https://upload.wikimedia.org/wikipedia/commons/0/02/Carhartt_logo.svg",
        Everlane:"https://upload.wikimedia.org/wikipedia/commons/7/7b/Everlane_logo.svg",
        Reformation:"https://upload.wikimedia.org/wikipedia/commons/1/1a/Reformation_%28company%29_logo.svg",
        ASOS:"https://upload.wikimedia.org/wikipedia/commons/5/5a/Asos-logo.svg",
        Reebok:"https://upload.wikimedia.org/wikipedia/commons/0/0e/Reebok_2019_logo.svg",
        "New Balance":"https://upload.wikimedia.org/wikipedia/commons/9/91/New_Balance_logo.svg",
        Puma:"https://upload.wikimedia.org/wikipedia/commons/f/fd/Puma-logo.svg",
        "Under Armour":"https://upload.wikimedia.org/wikipedia/commons/5/55/Under_armour_logo.svg"
      };

      /* ====================== Helpers ====================== */
      const cmToIn = (cm)=> cm/2.54;
      const inToCm = (inch)=> inch*2.54;
      const clamp = (n,a,b)=> Math.max(a,Math.min(b,n));
      const prettyRange = ([lo,hi], unit)=> { const f = unit==='in' ? cmToIn : (x)=>x; const a=Math.round(f(lo)*10)/10, b=Math.round(f(hi)*10)/10; return a+"–"+b+" "+unit; };
      const distToRange = ([lo,hi], v, pad=0)=>{ const L=lo-pad, H=hi+pad; if(v<L) return L-v; if(v>H) return v-H; return 0; };

      function detectUnitMismatch(unit, m){
        const vals = [m.chest, m.waist, m.hips].filter(v => Number.isFinite(v) && v>0);
        if (vals.length < 2) return null;
        const looksCm = vals.every(v => v>=60 && v<=130);
        const looksIn = vals.every(v => v>=20 && v<=55);
        if (unit==="cm" && looksIn) return "Your entries look like inches. Switch Units to inches?";
        if (unit==="in" && looksCm) return "Your entries look like centimeters. Switch Units to cm?";
        return null;
      }

      function fitAdjustments(fit){ if(fit==="Slim") return { tolBump:-0.5, sizeUpBias:0 }; if(fit==="Relaxed") return { tolBump:+0.5, sizeUpBias:1 }; return { tolBump:0, sizeUpBias:0.5 }; }

      function pickByRules(chart, measCm, category, padCm, strict, fit){
        if(!Array.isArray(chart) || chart.length===0) return null;
        const keys = category==='Tops' ? ['chest','waist','hips'] : ['waist','hips','inseam'];
        const { tolBump, sizeUpBias } = fitAdjustments(fit);
        const tol = Math.max(0, padCm + tolBump);

        if (strict) {
          for (const row of chart) {
            const ok = keys.every(k => !row[k] || distToRange(row[k], (measCm[k]||0), tol) === 0);
            if (ok) return { row, reason: 'strict_in_range', tol };
          }
        }
        for (let i=0;i<chart.length;i++){
          const row = chart[i];
          const notTooSmall = keys.every(k => !row[k] || (measCm[k]==null ? true : (measCm[k] <= row[k][1] + tol)));
          if (notTooSmall) {
            const nearTop = keys.some(k => row[k] && measCm[k]!=null && (row[k][1] - measCm[k]) <= (1 - sizeUpBias));
            if (nearTop && i+1 < chart.length && sizeUpBias >= 0.5) return { row: chart[i+1], reason: 'sized_up_by_fit', tol };
            return { row, reason: 'sized_up_to_fit', tol };
          }
        }
        return { row: chart[chart.length - 1], reason: 'over_max', tol };
      }

      function betweenSizes(chart, chosenRow, measCm, category, tol){
        const keys = category==='Tops' ? ['chest','waist','hips'] : ['waist','hips','inseam'];
        const idx = chart.findIndex(r => r.label === chosenRow.label);
        if (idx < 0 || idx === chart.length-1) return null;
        const next = chart[idx+1];
        const nearTop = keys.some(k => chosenRow[k] && measCm[k]!=null && (chosenRow[k][1] - measCm[k]) <= 1 + tol);
        const nearBottom = keys.some(k => next[k] && measCm[k]!=null && (measCm[k] - next[k][0]) <= 1 + tol);
        return (nearTop || nearBottom) ? next.label : null;
      }

      // ---------- Brand match scoring ----------
      function centerOf([lo, hi]) { return (lo + hi) / 2; }
      function scoreRowAgainstMeas(row, measCm, keys) {
        let used = 0, sum = 0;
        for (const k of keys) {
          if (!row[k] || measCm[k] == null) continue;
          const c = centerOf(row[k]);
          sum += Math.abs((measCm[k] || 0) - c);
          used++;
        }
        return used ? sum / used : Number.POSITIVE_INFINITY;
      }
      function brandMatchScore(chosen, measCm, category) {
        const keys = category === 'Tops' ? ['chest','waist','hips'] : ['waist','hips','inseam'];
        const base = scoreRowAgainstMeas(chosen.row, measCm, keys);
        const penalty = chosen.reason === 'over_max' ? 15 : 0;
        return base + penalty;
      }

      // Persistence + share
      const STORAGE_KEY = "sizeme:v3";
      function saveState(s){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); }catch{} }
      function loadState(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)||"null"); }catch{ return null; } }
      function encodeState(obj){ const json = JSON.stringify(obj); return btoa(unescape(encodeURIComponent(json))); }
      function decodeState(str){ try{ return JSON.parse(decodeURIComponent(escape(atob(str)))); }catch{ return null; } }

      // ---------- CSV helpers ----------
      function csvEscape(v){ if (v == null) return ""; const s = String(v); return /[",\n]/.test(s) ? `"${s.replace(/"/g,'""')}"` : s; }
      function toCSV(headers, rows){ const head = headers.map(csvEscape).join(","); const body = rows.map(r => headers.map(h => csvEscape(r[h])).join(",")).join("\n"); return head + "\n" + body; }

      /* ====================== UI ====================== */
      function Logo({ brand }){
        const [ok,setOk] = useState(true);
        const src = BRAND_LOGOS[brand];
        if (!src || !ok) return <div className="px-2 py-1 rounded-md border text-xs">{brand}</div>;
        return <img src={src} alt={brand} className="h-5" onError={()=>setOk(false)}/>;
      }

      function App(){
        const [unit, setUnit] = useState('cm');
        const [category, setCategory] = useState('Tops');
        const [gender, setGender] = useState('Men');
        const [brands, setBrands] = useState(Object.keys(SIZE_CHARTS));
        const [meas, setMeas] = useState({ chest:100, waist:84, hips:100, inseam:80, height:178 });
        const [tolerance, setTolerance] = useState(1.5);
        const [strict, setStrict] = useState(true);
        const [fit, setFit] = useState("Regular");
        const [calcTick, setCalcTick] = useState(0);
        const [showToast, setShowToast] = useState(false);
        const [btnPulse, setBtnPulse] = useState(false);
        const [dark, setDark] = useState(false);
        const [hydrated, setHydrated] = useState(false);
        const [unitPrompt, setUnitPrompt] = useState(null);
        const [unitPromptSeen, setUnitPromptSeen] = useState(false);
        const [selectedBrand, setSelectedBrand] = useState("");
        const [brandQuery, setBrandQuery] = useState("");

        // Share URL hydrate (wins)
        useEffect(()=>{ const q=new URLSearchParams(location.search); const s=q.get("s"); if(!s) return; const st=decodeState(s); if(!st) return;
          if(st.meas) setMeas(st.meas); if(st.unit) setUnit(st.unit); if(st.category) setCategory(st.category); if(st.gender) setGender(st.gender);
          if(st.tolerance!=null) setTolerance(st.tolerance); if(st.strict!=null) setStrict(st.strict); if(st.brands) setBrands(st.brands);
          if(st.fit) setFit(st.fit); if(st.dark!=null) setDark(st.dark); if(st.selectedBrand) setSelectedBrand(st.selectedBrand);
        },[]);

        // Storage hydrate (after URL)
        useEffect(()=>{ if(hydrated) return; const saved=loadState(); if(saved){
          if(saved.meas) setMeas(saved.meas); if(saved.unit) setUnit(saved.unit);
          if(saved.category) setCategory(saved.category); if(saved.gender) setGender(saved.gender);
          if(saved.tolerance!=null) setTolerance(saved.tolerance); if(saved.strict!=null) setStrict(saved.strict);
          if(saved.brands) setBrands(saved.brands); if(saved.fit) setFit(saved.fit); if(saved.dark!=null) setDark(saved.dark);
          if(saved.selectedBrand) setSelectedBrand(saved.selectedBrand);
        } setHydrated(true); },[hydrated]);

        // Persist
        useEffect(()=>{ if(!hydrated) return; saveState({ meas, unit, category, gender, tolerance, strict, brands, fit, dark, selectedBrand }); },[hydrated, meas, unit, category, gender, tolerance, strict, brands, fit, dark, selectedBrand]);

        // Auto-detect units (one-time prompt until dismissed)
        useEffect(()=>{ if (unitPromptSeen) return; const msg = detectUnitMismatch(unit, meas); setUnitPrompt(msg); }, [unit, meas, unitPromptSeen]);

        const measCm = useMemo(()=> unit==='cm' ? meas : ({
          chest: inToCm(meas.chest||0), waist: inToCm(meas.waist||0), hips: inToCm(meas.hips||0),
          inseam: inToCm(meas.inseam||0), height: inToCm(meas.height||0),
        }), [meas, unit]);

        const results = useMemo(()=>{
          const out={};
          for(const b of brands){
            const chart = SIZE_CHARTS[b] && SIZE_CHARTS[b][category] && SIZE_CHARTS[b][category][gender];
            if(!chart) continue;
            const chosen = pickByRules(chart, measCm, category, tolerance, strict, fit);
            if(!chosen) continue;
            const row = chosen.row, reason = chosen.reason, tol=chosen.tol;
            const maybeNext = betweenSizes(chart, row, measCm, category, tol);
            out[b] = { pick: row, reason, between: maybeNext, chart, chosen };
          }
          return out;
        }, [brands, category, gender, measCm, tolerance, strict, fit, calcTick]);

        // Matches array: {brand, score, reason}
        const matches = useMemo(()=>{
          const arr = Object.entries(results).map(([brand, data])=>{
            const score = brandMatchScore(data.chosen, measCm, category);
            return { brand, score, reason: data.reason };
          });
          arr.sort((a,b)=> a.score - b.score);
          return arr;
        }, [results, measCm, category]);

        const unitLabel = unit==='cm' ? 'cm' : 'in';
        function handleNumChange(k,val){ let v=parseFloat(val); if(Number.isNaN(v)) v=0; v=clamp(v,0,400); setMeas(m=>({...m,[k]:v})); }
        function printPDF(){ document.getElementById('results')?.scrollIntoView({ behavior:'instant', block:'start' }); window.print(); }

        // Reset & CSV export
        function resetAll(){
          const defaults = {
            unit: 'cm', category: 'Tops', gender: 'Men',
            brands: Object.keys(SIZE_CHARTS),
            meas: { chest:100, waist:84, hips:100, inseam:80, height:178 },
            tolerance: 1.5, strict: true, fit: 'Regular', dark: false, selectedBrand: "", brandQuery: ""
          };
          setUnit(defaults.unit); setCategory(defaults.category); setGender(defaults.gender); setBrands(defaults.brands);
          setMeas(defaults.meas); setTolerance(defaults.tolerance); setStrict(defaults.strict); setFit(defaults.fit);
          setDark(defaults.dark); setSelectedBrand(defaults.selectedBrand); setBrandQuery(defaults.brandQuery);
          try { localStorage.removeItem(STORAGE_KEY); } catch {}
          const url = new URL(location.href); url.searchParams.delete("s"); history.replaceState(null,"",url.toString());
          setShowToast(true); setTimeout(()=>setShowToast(false), 1200);
        }
        function downloadCSV(){
          const headers = ["brand","category","gender","size","reason","between","unit","tolerance_cm","strict","fit","input_chest","input_waist","input_hips","input_inseam","input_height","range_chest","range_waist","range_hips","range_inseam"];
          const rows = [];
          for (const [brand, data] of Object.entries(results)) {
            const row = data.pick;
            const range = (k)=> row[k] ? prettyRange(row[k], unit) : "";
            rows.push({
              brand, category, gender, size: row.label, reason: data.reason, between: data.between||"",
              unit, tolerance_cm: tolerance, strict, fit,
              input_chest: meas.chest ?? "", input_waist: meas.waist ?? "", input_hips: meas.hips ?? "", input_inseam: meas.inseam ?? "", input_height: meas.height ?? "",
              range_chest: range("chest"), range_waist: range("waist"), range_hips: range("hips"), range_inseam: range("inseam"),
            });
          }
          const csv = toCSV(headers, rows);
          const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a"); a.href = url; a.download = "size-me-recommendations.csv"; a.click();
          URL.revokeObjectURL(url);
        }

        return (
          <div className={dark ? "dark" : ""}>
            <div className="min-h-screen">
              {/* Header */}
              <header className="no-print sticky top-0 z-20 backdrop-blur border-b bg-white/70 dark:bg-slate-900/70 border-slate-200 dark:border-slate-700">
                <div className="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className="w-9 h-9 rounded-2xl bg-slate-900 text-white dark:bg-white dark:text-slate-900 flex items-center justify-center text-sm font-bold shadow">S</div>
                    <h1 className="text-2xl font-semibold">Size Me</h1>
                  </div>
                  <div className="flex items-center gap-2 text-sm">
                    <span className="mr-1">Units</span>
                    <div className="inline-flex rounded-xl border overflow-hidden border-slate-300 dark:border-slate-600">
                      <button className={"px-3 py-1 " + (unit==='cm'?'bg-slate-900 text-white':'bg-white dark:bg-slate-800 dark:text-slate-100')} onClick={()=>setUnit('cm')}>cm</button>
                      <button className={"px-3 py-1 " + (unit==='in'?'bg-slate-900 text-white':'bg-white dark:bg-slate-800 dark:text-slate-100')} onClick={()=>setUnit('in')}>in</button>
                    </div>
                    <button className="ml-3 rounded-xl border px-3 py-1 text-sm border-slate-300 dark:border-slate-600" onClick={()=>setDark(d=>!d)}>{dark ? "Light" : "Dark"}</button>
                  </div>
                </div>
                {unitPrompt && !unitPromptSeen && (
                  <div className="max-w-6xl mx-auto px-4 pb-3">
                    <div className="rounded-xl bg-amber-100 border border-amber-300 text-amber-900 px-4 py-3 flex flex-wrap items-center gap-3">
                      <span>{unitPrompt}</span>
                      <div className="ml-auto flex gap-2">
                        <button className="px-3 py-1 rounded-lg bg-amber-700 text-white" onClick={()=>{ setUnit(unit==='cm'?'in':'cm'); setUnitPromptSeen(true); }}>Switch units</button>
                        <button className="px-3 py-1 rounded-lg border border-amber-400" onClick={()=>{ setUnitPromptSeen(true); }}>Dismiss</button>
                      </div>
                    </div>
                  </div>
                )}
              </header>

              {/* Main */}
              <main className="max-w-6xl mx-auto px-4 py-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
                {/* Controls */}
                <section className="bg-white dark:bg-slate-900/70 rounded-2xl shadow-lg ring-1 ring-black/5 p-6">
                  <h2 className="text-lg font-semibold mb-4">Your measurements</h2>
                  <div className="grid grid-cols-2 gap-4">
                    {[
                      ['chest','Chest'], ['waist','Waist'], ['hips','Hips'], ['inseam','Inseam'], ['height','Height']
                    ].map(([key,label])=>(
                      <div key={key} className="flex flex-col">
                        <label className="text-sm text-slate-600 dark:text-slate-300 mb-1">{label} ({unitLabel})</label>
                        <input type="number" step="any" value={meas[key]} onChange={(e)=>handleNumChange(key, e.target.value)} className="rounded-xl border px-3 py-2 bg-white dark:bg-slate-800 border-slate-300 dark:border-slate-600"/>
                      </div>
                    ))}
                  </div>

                  <div className="mt-6 grid grid-cols-2 gap-4">
                    <div>
                      <label className="text-sm text-slate-600 dark:text-slate-300 mb-1">Category</label>
                      <select className="w-full rounded-xl border px-3 py-2 bg-white dark:bg-slate-800 border-slate-300 dark:border-slate-600" value={category} onChange={(e)=>setCategory(e.target.value)}>
                        {["Tops","Bottoms"].map(c=><option key={c} value={c}>{c}</option>)}
                      </select>
                    </div>
                    <div>
                      <label className="text-sm text-slate-600 dark:text-slate-300 mb-1">Fit</label>
                      <select className="w-full rounded-xl border px-3 py-2 bg-white dark:bg-slate-800 border-slate-300 dark:border-slate-600" value={gender} onChange={(e)=>setGender(e.target.value)}>
                        {["Men","Women"].map(g=><option key={g} value={g}>{g}</option>)}
                      </select>
                    </div>
                  </div>

                  <div className="mt-6 grid grid-cols-1 sm:grid-cols-3 gap-4 items-end">
                    <div>
                      <label className="text-sm text-slate-600 dark:text-slate-300 mb-1 block">Tolerance (cm)</label>
                      <input type="number" min="0" max="5" step="0.5" value={tolerance} onChange={(e)=>setTolerance(clamp(parseFloat(e.target.value)||0,0,5))} className="rounded-xl border px-3 py-2 w-28 bg-white dark:bg-slate-800 border-slate-300 dark:border-slate-600"/>
                    </div>
                    <div>
                      <label className="text-sm text-slate-600 dark:text-slate-300 mb-1 block">Fit preference</label>
                      <select className="w-full rounded-xl border px-3 py-2 bg-white dark:bg-slate-800 border-slate-300 dark:border-slate-600" value={fit} onChange={(e)=>setFit(e.target.value)}>
                        {["Slim","Regular","Relaxed"].map(f=><option key={f} value={f}>{f}</option>)}
                      </select>
                    </div>
                    <label className="inline-flex items-center gap-2">
                      <input type="checkbox" checked={strict} onChange={(e)=>setStrict(e.target.checked)}/>
                      <span className="text-sm text-slate-700 dark:text-slate-200">Strict match (never pick too small)</span>
                    </label>
                  </div>

                  <div className="mt-6">
                    <label className="text-sm text-slate-600 dark:text-slate-300 mb-2 block">Brands</label>
                    <div className="grid grid-cols-2 sm:grid-cols-3 gap-2">
                      {Object.keys(SIZE_CHARTS).map(b=>{
                        const checked = brands.includes(b);
                        return (
                          <label key={b} className={"flex items-center gap-2 rounded-xl border px-3 py-2 cursor-pointer " + (checked ? "bg-slate-900 text-white border-slate-900" : "bg-white dark:bg-slate-800 border-slate-300 dark:border-slate-600")}>
                            <input className="hidden" type="checkbox" checked={checked} onChange={(e)=>{ setBrands(prev => e.target.checked ? Array.from(new Set(prev.concat([b]))) : prev.filter(x=>x!==b)); }}/>
                            <Logo brand={b}/>
                            <span className="text-sm font-medium">{b}</span>
                          </label>
                        );
                      })}
                    </div>
                  </div>

                  <div className="mt-6 flex flex-wrap gap-3 no-print">
                    <button className={"rounded-xl bg-slate-900 text-white px-4 py-2 shadow " + (btnPulse ? "pulse" : "")} onClick={()=>{ setCalcTick(t => t + 1); setShowToast(true); setBtnPulse(true); setTimeout(()=>setShowToast(false),1500); setTimeout(()=>setBtnPulse(false),500); document.getElementById('results')?.scrollIntoView({ behavior:'smooth', block:'start' }); }}>Calculate</button>
                    <button className="rounded-xl border px-4 py-2" onClick={()=>{ const preset = unit==='cm' ? { chest:100, waist:84, hips:100, inseam:80, height:178 } : { chest:39.4, waist:33.1, hips:39.4, inseam:31.5, height:70.1 }; setMeas(preset); }}>Use sample</button>
                    <button className="rounded-xl border px-4 py-2" onClick={()=>{ const resOut = {}; const measCmNow = unit==='cm' ? meas : { chest: inToCm(meas.chest||0), waist: inToCm(meas.waist||0), hips: inToCm(meas.hips||0), inseam: inToCm(meas.inseam||0), height: inToCm(meas.height||0) }; for(const b of brands){ const chart = SIZE_CHARTS[b] && SIZE_CHARTS[b][category] && SIZE_CHARTS[b][category][gender]; const chosen = pickByRules(chart, measCmNow, category, tolerance, strict, fit); if(chosen) resOut[b]=chosen.row; } const blob = new Blob([JSON.stringify({ input:{ unit, category, gender, meas, tolerance, strict, brands, fit }, results: resOut }, null, 2)], { type:"application/json" }); const url = URL.createObjectURL(blob); const a = document.createElement("a"); a.href = url; a.download = "size-me-results.json"; a.click(); URL.revokeObjectURL(url); }}>Export results (JSON)</button>
                    <button className="rounded-xl border px-4 py-2" onClick={()=>{ const payload = { meas, unit, category, gender, tolerance, strict, brands, fit, dark, selectedBrand }; const url = new URL(location.href); url.searchParams.set("s", encodeState(payload)); navigator.clipboard.writeText(url.toString()); setShowToast(true); setTimeout(()=>setShowToast(false),1500); }}>Copy shareable link</button>
                    <button className="rounded-xl border px-4 py-2" onClick={printPDF}>Print recommendations</button>
                    <button className="rounded-xl border px-4 py-2" onClick={downloadCSV}>Download CSV</button>
                    <button className="rounded-xl border px-4 py-2" onClick={resetAll}>Reset all</button>
                  </div>

                  <p className="mt-4 text-xs text-slate-500 dark:text-slate-400">Prototype only. Ranges are approximate and may vary by style/fabric. Use tolerance & fit preference to reflect how you like clothes to fit.</p>
                </section>

                {/* Results + Brand Recommendations */}
                <section id="results" className="bg-white dark:bg-slate-900/70 rounded-2xl shadow-lg ring-1 ring-black/5 p-6">
                  <div id="results-print">
                    {/* Top matches & search */}
                    <div className="mb-5 rounded-2xl border border-slate-200 dark:border-slate-700 p-4">
                      <div className="flex items-center justify-between gap-3 mb-3">
                        <h3 className="text-sm font-semibold tracking-wide uppercase text-slate-600 dark:text-slate-300">Top matches</h3>
                        <div className="flex items-center gap-2">
                          <input
                            list="brand-list"
                            value={brandQuery}
                            onChange={(e)=>setBrandQuery(e.target.value)}
                            onKeyDown={(e)=>{ if(e.key==='Enter' && brandQuery){ setSelectedBrand(brandQuery); } }}
                            placeholder="Search brand…"
                            className="text-sm rounded-lg border px-2 py-1 bg-white dark:bg-slate-800 border-slate-300 dark:border-slate-600"
                            style={{minWidth: '12rem'}}
                          />
                          <datalist id="brand-list">
                            {Object.keys(SIZE_CHARTS).map(b => <option key={b} value={b} />)}
                          </datalist>
                          <button className="text-sm rounded-lg border px-3 py-1 border-slate-300 dark:border-slate-600" onClick={()=> setSelectedBrand(brandQuery)}>Select</button>
                          {selectedBrand && (
                            <button className="text-sm rounded-lg border px-3 py-1 border-slate-300 dark:border-slate-600" onClick={()=> { setSelectedBrand(""); setBrandQuery(""); }}>Clear</button>
                          )}
                        </div>
                      </div>

                      <ul className="space-y-2">
                        {matches.slice(0,5).map(({brand, score, reason})=>{
                          const maxScore = Math.max(matches[0]?.score || 1, matches[4]?.score || 1) || 1;
                          const pct = Math.max(0, 100 - Math.min(100, (score / (maxScore || 1)) * 100)); // higher pct = better
                          return (
                            <li key={brand} className="flex items-center gap-3">
                              <div className="w-40 flex items-center gap-2">
                                <Logo brand={brand} />
                                <button className="text-sm underline decoration-dotted underline-offset-4" onClick={()=>{ setSelectedBrand(brand); setBrandQuery(brand); }} title="Focus this brand">{brand}</button>
                              </div>
                              <div className="flex-1 h-2 rounded-full bg-slate-200 dark:bg-slate-700 overflow-hidden">
                                <div className="h-2 bg-slate-900 dark:bg-white" style={{width: pct+'%'}}/>
                              </div>
                              <div className="w-20 text-right text-xs text-slate-600 dark:text-slate-300">{reason.replaceAll('_',' ')}</div>
                            </li>
                          );
                        })}
                      </ul>
                      <p className="mt-2 text-xs text-slate-500 dark:text-slate-400">Bars show relative closeness for your current measurements (higher is better). “over max” brands are penalized.</p>
                    </div>

                    {/* Focused vs general results */}
                    {selectedBrand && results[selectedBrand] ? (
                      <>
                        <h2 className="text-lg font-semibold mb-4">Recommended size — {selectedBrand}</h2>
                        <ResultsPanel unit={unit} results={{ [selectedBrand]: results[selectedBrand] }} category={category}/>
                        <h3 className="mt-6 mb-2 text-sm font-semibold tracking-wide uppercase text-slate-600 dark:text-slate-300">Also consider</h3>
                        <ResultsPanel
                          unit={unit}
                          results={Object.fromEntries(
                            matches
                              .filter(m => m.brand !== selectedBrand)
                              .slice(0,3)
                              .map(m => [m.brand, results[m.brand]])
                          )}
                          category={category}
                        />
                      </>
                    ) : (
                      <>
                        <h2 className="text-lg font-semibold mb-4">Recommended sizes</h2>
                        <ResultsPanel
                          unit={unit}
                          results={Object.fromEntries(matches.slice(0,5).map(m => [m.brand, results[m.brand]]))}
                          category={category}
                        />
                      </>
                    )}
                  </div>
                </section>
              </main>

              {/* Toast */}
              {showToast && (<div className="no-print fixed bottom-6 right-6 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg">Done ✓</div>)}
            </div>
          </div>
        );
      }

      function ResultsPanel({ unit, results, category }){
        const entries = Object.entries(results);
        if(entries.length===0) return <div className="text-slate-500">No brands selected.</div>;
        const keys = category==='Tops' ? ['chest','waist','hips'] : ['waist','hips','inseam'];

        return (
          <ul className="space-y-3">
            {entries.map(([brand, data])=>{
              const row = data.pick;
              let badge;
              if (data.reason === 'strict_in_range')    badge = <span className="ml-2 text-xs rounded-md px-2 py-0.5 border border-green-600 text-green-700">in range</span>;
              else if (data.reason === 'sized_up_to_fit')badge = <span className="ml-2 text-xs rounded-md px-2 py-0.5 border border-blue-600 text-blue-700">sized up</span>;
              else if (data.reason === 'sized_up_by_fit')badge = <span className="ml-2 text-xs rounded-md px-2 py-0.5 border border-indigo-600 text-indigo-700">sized up (fit)</span>;
              else                                       badge = <span className="ml-2 text-xs rounded-md px-2 py-0.5 border border-rose-600 text-rose-700">over max</span>;

              return (
                <li key={brand} className="print-card rounded-2xl border border-slate-200 dark:border-slate-700 p-4">
                  <div className="flex items-center justify-between gap-4">
                    <div className="flex items-center gap-3">
                      <Logo brand={brand}/>
                      <div>
                        <div className="text-base font-medium">{brand}</div>
                        <div className="text-sm text-slate-600 dark:text-slate-300">{category}</div>
                      </div>
                    </div>
                    <div className="text-2xl font-semibold flex items-center">
                      {row.label}{badge}
                      {data.between && <span className="ml-2 text-xs rounded-md px-2 py-0.5 border border-slate-400 dark:border-slate-600 text-slate-600 dark:text-slate-300">between {row.label} / {data.between}</span>}
                    </div>
                  </div>

                  <div className="mt-3 grid grid-cols-2 sm:grid-cols-4 gap-2 text-sm">
                    {keys.map(k => {
                      if(!row[k]) return null;
                      const label = k[0].toUpperCase() + k.slice(1);
                      return (
                        <div key={k} className="rounded-lg bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 p-2">
                          <div className="text-slate-500 dark:text-slate-400">{label} range</div>
                          <div className="font-medium">{prettyRange(row[k], unit)}</div>
                        </div>
                      );
                    })}
                  </div>
                </li>
              );
            })}
          </ul>
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
  </body>
</html>
